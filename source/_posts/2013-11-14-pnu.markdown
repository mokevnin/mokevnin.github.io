---
layout: post
title: "Принцип наименьшего удивления (ПНУ)"
date: 2013-11-14 23:54
comments: true
categories:
---

Несмотря на то что этот [принцип](http://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%B0%D0%B2%D0%B8%D0%BB%D0%BE_%D0%BD%D0%B0%D0%B8%D0%BC%D0%B5%D0%BD%D1%8C%D1%88%D0%B5%D0%B3%D0%BE_%D1%83%D0%B4%D0%B8%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F) достаточно известный и понятный, часто им пренебрегают думая что “в моей ситуации по другому нельзя”, либо просто не понимая последствий этого решения для будущей поддержки проекта.

Небольшая оговорка: рекомендую посмотреть мое выступление с докладом “ментальное программирование” где изложена эта и многие другие концепции.

Разберем конкретный пример.
Исходные данные: В проекте есть CRUD для управления пользователями.
Задача: вместо удаления делать soft destroy, чтобы иметь возможность восстановить пользователя.

<!-- more -->

В коде удаление выглядит вот так: user.destroy().

Любой опытный ruby девелопер сразу же находит множество гемов которые решают эту задачу. В большинстве случаев решение сводится к _переопределению_ метода destroy, таким образом, что теперь он выставляет флаг “deleted”. У некоторых при этом, где-то глубоко в мозгу, возникает мысль “а не хуйню ли я делаю?”.

Что же мы натворили?

* Стандартное, общепринятое решение, теперь, в некоторых ситуациях, работает _особым_ образом, нарушая ПНУ, а заодно не соответствует принципам “ментального программирования”. Это в свою очередь приводит к тому что программисту нужно больше держать в голове деталей, и постоянно сомневаться. Легко ли вы выполните user.destroy в терминале на продакшене? ;) Я думаю что вы сначала будете думать “а сработает ли” и самое хреновое, то что оно может не сработать (бага, настройки, удалили гем и заменили на другой).
* Вырабатывается неправильная привычка из-за которой в другом проекте (с другим подходом) можно поиметь проблем.
* Поле “destroyed” это, вообще говоря, неверно. Наличие полей определяющих состояния вместо нормального конечного автомата, приводит к куче говнокода и постоянной рукопашке (учитывая наличие нормальных гемов).

А давайте проведем эксперимент. Предлагаю всем заинтересованным написать свои подходы для решения этой задачи в комментариях, и после этого я опубликую вторую часть статьи.

